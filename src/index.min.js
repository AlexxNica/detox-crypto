/*
 Copyright (c) 2017, Nazar Mokrynskyi
 @license   MIT License, see license.txt
*/
(function(){function m(c){var d;for(d=c.length-1;0<=d;--d){var e=d;++c[e];if(0!==c[e])break}}function h(c,d,e,b){function f(a){!a&&(a=null);if(!(this instanceof f))return new f(a);null===a&&(a=k(48));this.b=a;this.a=new Uint8Array(12)}function g(a,l){if(!(this instanceof g))return new g(a,l);a?(this.a=b.HandshakeState(n,b.constants.NOISE_ROLE_INITIATOR),this.a.Initialize(null,null,l)):(this.a=b.HandshakeState(n,b.constants.NOISE_ROLE_RESPONDER),this.a.Initialize(null,l))}f.prototype={get_key:function(){return this.b},
wrap:function(a){m(this.a);return e.encrypt(a,new Uint8Array(0),this.a,this.b,0)},unwrap:function(a){m(this.a);return e.decrypt(a,new Uint8Array(0),this.a,this.b,0)}};Object.defineProperty(f.prototype,"constructor",{enumerable:!1,value:f});g.prototype={ready:function(){return!this.a},get_handshake_message:function(){var a=null;this.a&&(this.a.GetAction()===b.constants.NOISE_ACTION_WRITE_MESSAGE&&(a=this.a.WriteMessage()),this.b());return a},b:function(){if(this.a.GetAction()===b.constants.NOISE_ACTION_SPLIT){var a=
this.a.Split();this.f=a[0];this.c=a[1];delete this.a}else if(this.a.GetAction()===b.constants.NOISE_ACTION_FAILED)throw delete this.a,Error("Noise handshake failed");},put_handshake_message:function(a){this.a&&(this.a.GetAction()===b.constants.NOISE_ACTION_READ_MESSAGE&&this.a.ReadMessage(a),this.b())},encrypt:function(a){return this.f.EncryptWithAd(new Uint8Array(0),a)},decrypt:function(a){return this.c.DecryptWithAd(new Uint8Array(0),a)}};Object.defineProperty(g.prototype,"constructor",{enumerable:!1,
value:g});return{ready:function(a){Promise.all([new Promise(function(a){c.ready(a)}),new Promise(function(a){d.ready(a)}),new Promise(function(a){e.ready(a)}),new Promise(function(a){b.ready(a)})]).then(function(){a()})},create_keypair:function(a){!a&&(a=null);a||(a=c.createSeed());var b=c.createKeyPair(a);return{seed:a,ed25519:{"public":b.publicKey,"private":b.secretKey},x25519:{"public":d.convert_public_key(b.publicKey),"private":d.convert_private_key(a)}}},convert_public_key:function(a){return d.convert_public_key(a)},
Rewrapper:f,Encryptor:g}}var k;"object"===typeof exports?k=require("crypto").randomBytes:k=function(c){c=new Uint8Array(c);crypto.getRandomValues(c);return c};var n="Noise_NK_25519_ChaChaPoly_BLAKE2b";"function"===typeof define&&define.a?define(["supercop.wasm","ed25519-to-x25519.wasm","aez.wasm","noise-c.wasm"],h):"object"===typeof exports?module.exports=h(require("supercop.wasm"),require("ed25519-to-x25519.wasm"),require("aez.wasm"),require("noise-c.wasm")):this.detox_crypto=h(this.supercop_wasm,
this.ed25519_to_x25519_wasm,this.aez_wasm,this.noise_c_wasm)}).call(this);